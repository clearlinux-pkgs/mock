From 4e0d7922f5dc619455900ba0cb238b0cb9a7815d Mon Sep 17 00:00:00 2001
From: Alberto Murillo <alberto.murillo.silva@intel.com>
Date: Wed, 2 Dec 2015 13:14:34 -0600
Subject: [PATCH] Stateless conversion

---
 py/mock.py           | 2 ++
 py/mockbuild/util.py | 4 ++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/py/mock.py b/py/mock.py
index 0b68d38..6ee10ef 100755
--- a/py/mock.py
+++ b/py/mock.py
@@ -354,6 +354,8 @@ def setup_logging(config_path, config_opts, options):
                 log.warning("Could not find required logging config file: %s. Using default..." % log_ini)
                 log_ini = os.path.join("/etc/mock", config_opts["log_config_file"])
                 if not os.path.exists(log_ini):
+                    log_ini = config_opts["log_config_file"]
+                if not os.path.exists(log_ini):
                     raise IOError("Could not find log config file %s" % log_ini)
             else:
                 raise IOError("Could not find log config file %s" % log_ini)
diff --git a/py/mockbuild/util.py b/py/mockbuild/util.py
index d868a33..92569a6 100644
--- a/py/mockbuild/util.py
+++ b/py/mockbuild/util.py
@@ -652,7 +652,7 @@ def setup_default_config_opts(unprivUid, version, pkgpythondir):
     config_opts['check'] = True
     config_opts['post_install'] = False
     config_opts['chroothome'] = '/builddir'
-    config_opts['log_config_file'] = 'logging.ini'
+    config_opts['log_config_file'] = '/usr/share/defaults/mock/logging.ini'
     config_opts['rpmbuild_timeout'] = 0
     config_opts['chrootuid'] = unprivUid
     try:
@@ -1068,7 +1068,7 @@ def load_config(config_path, name, uidManager, version, PKGPYTHONDIR):
     config_opts['config_file'] = chroot_cfg_path
 
     cfg = os.path.join(config_path, 'site-defaults.cfg')
-    do_update_config(log, config_opts, cfg, uidManager, name)
+    do_update_config(log, config_opts, cfg, uidManager, name, skipError=True)
 
     do_update_config(log, config_opts, chroot_cfg_path, uidManager, name, skipError=False)
 
-- 
2.1.0

